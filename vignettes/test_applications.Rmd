---
title: "testApplication"
author: "Steffen Ehrmann"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Hi Arne, ich hab dein Beispiel mal in diese Vignette verfrachtet, so können wir alle use-cases hier sammeln. Könnte vlt für später ganz nützlich sein, da wir das dann relativ einfach weiterverwenden können. Diese vignette kannst du oben mit "Knit" bauen, dabei werden alle code-chunks (durch ````{r}` angezeigt) gebaut, die nicht `eval=FALSE` als chunk-option gesetzt haben.

```{r, message=FALSE}
# imports (I put them in a chunk that doesn't report the output, as we are not interested in all the "warnings"...)
library(stringr)
library(checkmate)
library(rlang)
library(tibble)
library(dplyr)
library(tidyr)
library(magrittr)
library(readr)
```

```{r}
# # load functions from rectR
# path = "C:/Users/arue/Projects/GeoKur/Luckinet/rectr/R/"
# fileNames <- dir(path, pattern =".R")
# for(i in 1:length(fileNames)){
#   source(str_glue('C:/Users/arue/Projects/GeoKur/Luckinet/rectr/R/', fileNames[i]))
# }

# hier kannst du alternativ auch das paket bauen (Ctrl + Shift + B) und dann 
# ebenfalls mit 
library(rectr)
# einlesen (falls es baut...)

messyTable = read_csv(file = './messyTable.csv', col_types = 'cccii')
messySchema = list(clusters = 
                     list(top = NULL, left = NULL, width = NULL, height = NULL,
                          key = NULL),
                   variables = 
                     list(territories = 
                            list(type = "id", name = NULL, form = "long",
                                 row = NULL, col = 1, rel = FALSE),
                          period = 
                            list(type = "id", name = "year", form = "long",
                                 row = NULL, col = 2, rel = FALSE),
                          dimension =
                            list(type = "id", name = NULL, form = "long",
                                 row = NULL, col = 3, rel = FALSE),
                          # the commodities are spread over two columns and thus the
                          # variable is "wide".
                          commodities = 
                            list(type = "id", name = NULL, form = "wide",
                                 row = 1, col = c(4, 5), rel = FALSE),
                          # after rearranging, "dimension" is a long variable, which
                          # also needs to be adapted.
                          harvested = 
                            list(type = "values", unit = "ha", factor = 1,
                                 row = NULL, col = 3, rel = FALSE, 
                                 id = "dimension", value = "harvested"),
                          production = 
                            list(type = "values", unit = "t", factor = 1,
                                 row = NULL, col = 3, rel = FALSE, 
                                 id = "dimension", value = "production"))) #im manuscript steht hier value = "harvested"

# record(input = messyTable, schema = messySchema)
# test = meta_object
# # environment(meta_object)
# # meta_object
# temp = reorganise(input = messyTable)
```

Ich hab die Funktionen mit dem Hintergrund-Gedanken gebaut, dass die in einem "tidy workflow" verwendet werden, also folgendermaßen.

```{r}
# use magrittr pipeline ...
tidyTable <- record(input = messyTable, schema = messySchema) %>% 
  reorganise()

# ... or not
tempTable <- record(input = messyTable, schema = messySchema)
tidyTable <- reorganise(input = tempTable)

tidyTable
```

Da die Tabelle wohl zwei Spalten und null Zeilen hat, stimmt in der Tat irgendwas nicht.